---
import i18next from 'i18next'
import { localizePath } from 'node_modules/astro-i18next/src'
import { getRelativeLocaleUrl } from 'astro:i18n'
import GlassMorphism from './GlassMorphism'

const locale = i18next.language

// Memoize the localizePath function
const memoizedLocalizePath = (() => {
	const cache: { [key: string]: string } = {}
	return (path: string, locales: string = locale) => {
		const cacheKey = `${path}|${locales}`
		if (cache[cacheKey]) return cache[cacheKey]
		const result = localizePath(path, locales)
		cache[cacheKey] = result
		return result
	}
})()

const navLinks = [
	{
		href: getRelativeLocaleUrl(locale, memoizedLocalizePath('/')),
		label: i18next.t('navbar.home'),
	},
	{
		href: getRelativeLocaleUrl(
			locale,
			memoizedLocalizePath('/datenschutz'),
		),
		label: i18next.t('navbar.privacy'),
	},
	{
		href: getRelativeLocaleUrl(locale, memoizedLocalizePath('/impressum')),
		label: i18next.t('navbar.imprint'),
	},
	{
		href: getRelativeLocaleUrl(locale, memoizedLocalizePath('/anmeldung')),
		label: i18next.t('navbar.login'),
	},
]
---

<nav class="d-nav rounded-lg">
	<GlassMorphism class="py-4">
		<div class="container mx-auto px-4 flex justify-between items-center">
			<div class="navbar-brand float-left">
				<a
					href={getRelativeLocaleUrl(locale, '')}
					class="text-black font-bold"
				>
					<div class="backdrop-blur-md bg-[url('/favicon.ico')]">
						<img
							data-twe-animation-start="onLoad"
							class="animate-bounce w-[27px] z-1"
							src="/favicon.ico"
						/>
					</div>
				</a>
			</div>
			<ul class="navbar-nav flex space-x-4 float-right">
				{
					navLinks.map(({ href, label }) => (
						<li class="nav-item">
							<a
								class="nav-link text-black hover:text-gray-600"
								href={href}
							>
								{label}
							</a>
						</li>
					))
				}
				<li class="nav-item">
					<button id="change-lang-btn"><span>ChangeLang</span></button
					>
				</li>
			</ul>
		</div>
	</GlassMorphism>
</nav>

<script></script>
